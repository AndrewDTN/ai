# 反傳遞演算法


$f(x,y) = ((2*x)+(y+1))^2$

在 x=3, y=2 時，正向傳遞後再反向傳遞的結果為：

運算式               | 正向傳遞  |  閘的梯度                     | 反向傳遞
---------------------|----------|------------------------------|------------
x = 3                | p=6      | $g^x_f = ??$                 | 36
y = 2                | p=6      | $g^y_f = ??$                 | 18
p = 2*x = 2x         | p=6      | $g^x_p = 2$                  | $g^x_f = g^p_f*g^x_p=18*2=36$
q = y+1              | q=3      | $g^y_q = 1$                  | $g^y_f = g^q_f*g^y_q=18*1=18$
r = p+q = 2x+y+1     | r=9      | $g^q_r = 1$ ; $g^p_r = 1$    | $g^q_f = g^r_f*g^q_r=18*1$ ;  $g^p_f=g^r_f*g^p_r=18*1$
$f = r*r = (2x+y+1)^2$ | f=9*9    | $g^r_f = 2r=18$              | $g^r_f = g^r_f*g^f_f=18$
f = f                | f=81     |                              | $g^f_f = 1$


```
2x  => p
       + => r*r => f
y+1 => q
```

$g^x_f = g^r_f * g^p_r * g^x_p = 1*18*2=36$

$g^y_f = g^r_f * g^q_r * g^y_q = 1*18*1=18$


檢驗: 

> 正向: $f(x,y) = ((2*x)+(y+1))^2 = (2*3+2+1)^2 = 9^2 = 81$
> 
> 反向:
> 
> $g^x_f = 8x + 4y + 4 = 8*3 + 4*2 + 4 = 36$
> 
> $g^y_f = 4x + 2y + 2 = 4*3 + 2*2 + 2 = 18$

